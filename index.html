<html>

<head>
  <title>Title</title>
  <style>
    body {
      background-color: #f4f4f4;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      text-align: center
    }

    h1 {
      color: #333
    }

    input {
      margin-left: 10px;
      padding: 5px
    }

    button {
      border: none;
      border-radius: 5px;
      color: #fff;
      cursor: pointer;
      margin-right: 5px;
      padding: 10px 20px
    }

    p {
      margin: 10px 0
    }

    .container {
      margin-bottom: 20px
    }

    .output-container {
      font-size: 18px;
      margin-top: 20px
    }

    #errorLabel {
      color: #f44336;
      font-size: 1.5vh;
    }
  </style>
</head>

<body>

  <h1>Title</h1>

  <div class="container">
    <label for="ch1uld">CH1ULD:</label>
    <input type="number" id="ch1uld" placeholder="Enter value" onchange="validateInput(this.value, 'ch1uld')">
  </div>

  <div class="container">
    <label for="ch1lld">CH1LLD:</label>
    <input type="number" id="ch1lld" placeholder="Enter value" onchange="validateInput(this.value, 'ch1lld')">
  </div>

  <div class="container">
    <label for="ch2uld">CH2ULD:</label>
    <input type="number" id="ch2uld" placeholder="Enter value" onchange="validateInput(this.value, 'ch2uld')">
  </div>

  <div class="container">
    <label for="ch2lld">CH2LLD:</label>
    <input type="number" id="ch2lld" placeholder="Enter value" onchange="validateInput(this.value, 'ch2lld')">
  </div>

  <div class="container">
    <span id="errorLabel"></span>
  </div>

  <button onclick="onStartClick()" style="background-color: #008CBA">Start</button>
  <button onclick="onStopClick()" style="background-color: #f44336">Stop</button>
  <button onclick="onResetClick()" style="background-color: #555">Reset</button>

  <div class="output-container">
    <p>CH1: <span id="ch1Output">0</span></p>
    <p>CH2: <span id="ch2Output">0</span></p>
    <p>Time: <span id="timeOutput">0</span></p>
  </div>

  <script>
    let ch1uld = document.getElementById('ch1uld');
    let ch1llp = document.getElementById('ch1lld');
    let ch2ulp = document.getElementById('ch2uld');
    let ch2llp = document.getElementById('ch2lld');
    let errorLabel = document.getElementById('errorLabel');

    let ch1uldValue, ch1lldValue, ch2uldValue, ch2lldValue;
    let ch1Output = 0, ch2Output = 0, timeOutput = 0;
    let interval = null;

    function validateInput(value, id) {
      document.getElementById(id).value = validate(value, id);
    }

    function validate(value) {
      let parsedValue = parseInt(value);

      if (parsedValue > 4096) {
        return 4096;
      }
      else if (parsedValue < 0) {
        return 0;
      }
      else {
        return parsedValue;
      }
    }

    function onStartClick() {
      ch1uldValue = validate(ch1uld.value);
      ch1lldValue = validate(ch1lld.value);
      ch2uldValue = validate(ch2uld.value);
      ch2lldValue = validate(ch2lld.value);

      let error = null;

      if (!ch1uldValue && ch1uldValue !== 0) {
        error = "Enter a value between 0 and 4096 for CH1ULD";
      }
      else if (!ch1lldValue && ch1lldValue !== 0) {
        error = "Enter a value between 0 and 4096 for CH1LLD";
      }
      else if (!ch2uldValue && ch2uldValue !== 0) {
        error = "Enter a value between 0 and 4096 for CH2ULD";
      }
      else if (!ch2lldValue && ch2lldValue !== 0) {
        error = "Enter a value between 0 and 4096 for CH2LLD";
      }
      else if (interval != null) {
        error = "Please terminate the running process before proceeding";
      }

      if (!error) {
        errorLabel.style.display = "none";
        interval = setInterval(() => {
          const data = {
            ch1uld: ch1uldValue,
            ch1lld: ch1lldValue,
            ch2uld: ch2uldValue,
            ch2lld: ch2lldValue,
          };

          const options = {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
          };

          fetch("/configure", options)
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              return response.json();
            })
            .then(data => {
              console.log('Response:', data);
            })
            .catch(fetchError => {
              error = fetchError;
            });
        }, 1000);
      }

      if (error) {
        errorLabel.innerText = error;
        errorLabel.style.display = "inline";
      }
    }

    function onStopClick() {
      clearInterval(interval);
      interval = null;
    }

    function onResetClick() {
      ch1Output = 0;
      ch2Output = 0;
      timeOutput = 0;
      updateOutputs();
    }

    function updateOutputs() {
      document.getElementById('ch1Output').innerText = ch1Output;
      document.getElementById('ch2Output').innerText = ch2Output;
      document.getElementById('timeOutput').innerText = timeOutput;
    }
  </script>
</body>

</html>